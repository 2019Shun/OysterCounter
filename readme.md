# 🦪 牡蠣カウンター v1.0.0-beta.4

## 概要

**牡蠣カウンター**は、音声認識を使って牡蠣の「長さ（mm）」と「重さ（g）」「メモ」を記録・管理するWebアプリケーションです。  
計測データはテーブル形式で保存され、CSVファイルとしてダウンロードすることが可能です。

音声で「次」と言うと新しい行が追加され、「○○ミリ」「○○グラム」と話すと自動的に数値が入力されます。  
また、入力済みの数値は手動で編集することも可能です。

「メモ」と言うとメモ入力モーダルが表示され、続けて話した内容を記録し、CSVに出力することができます。

---

## 📦 主な機能

- 🎙️ **音声認識で「長さ」「重さ」「メモ」を自動入力**
- ➕ 「次」または「はい」と発声すると新規行を**先頭に追加**
- 📝 「メモ」と発言すると**メモ入力モーダル**が表示され、続けて話した内容を記録可能
- 💾 「保存」と発言すると、メモが対象行に保存され、**CSVにも反映**
- 🔁 同じ行のデータは「次」または「はい」で切り替えるまで**音声で上書き可能**
- ✏️ 全セルが**手動編集可能**
- 📥 CSV形式でダウンロード（**メモ欄も含まれる**）

---

## 🧑‍💻 使い方

### 1. アプリ起動

ブラウザでこのWebアプリを開きます。  
（※ 音声認識には **Google Chrome** など [SpeechRecognition API](https://developer.mozilla.org/ja/docs/Web/API/SpeechRecognition) に対応したブラウザが必要です）

---

### 2. 音声認識を開始

画面上部のボタンから：

- ▶️ **「開始」ボタンをクリック**：音声認識がスタートし、1行目が自動で追加されます。  
  ※「開始」後でないと「終了」ボタンは使用できません
- 🛑 **「終了」ボタンをクリック** または **「終了」と発声**：音声認識を停止します

---

### 3. 音声でデータ入力

- 「**○○ミリ**」または「**○○ミリメートル**」と言う → **長さ**が入力されます  
- 「**○○グラム**」と言う → **重さ**が入力されます  
- 「**次**」と言う → **新しい行**が追加されます（現在の行に長さ・重さが両方入力されていないと追加されません）

> 💡 **補足**：  
> 「次」と発言して新しい行が作成されるまでは、同じ行への音声入力は**常に上書きされます**。  
> 例：すでに「150ミリ」と入力された状態でも「160ミリ」と発言すると**160に上書き**されます。

---

### 4. 入力データの編集

音声で入力された「長さ」や「重さ」は、あとから直接**セルをクリックして手動で修正可能**です。

---

### 5. データ確認

音声入力された内容は画面にリアルタイム表示され、下の表に記録されていきます。

| 長さ(mm) | 重さ(g) |
|----------|---------|
| 160.2    | 24.5    |
| 153.4    | 30.1    |

---

### 7. メモ機能

「メモ」と言うとモーダルが開き、続けて話した内容を記録。

- 長さ・重さの記録から続けて、発言した内容を記録することができます。
- 「保存」と言えば、発言した内容が内部に保持され、CSV出力時に同時に出力されます。
- 「キャンセル」と言えば、発言した内容を破棄して、もとの画面に戻ります。

> 💡 **補足**：  
> 音声入力中は誤作動防止のためクリックでのメモモーダルの起動を制限しています。

---

### 8. データのダウンロード

- 💾 **「ダウンロード」ボタンをクリック**：現在のデータをCSV形式で保存できます  
  ※ テーブルに1行もない場合はボタンが無効になります  
  ファイル名は `data_YYYY-MM-DD_HHMMSS.csv` の形式で自動生成されます

---

## ⚠️ 注意点

- 最新の **Google Chrome** を推奨  
- 音声認識が途切れても自動で再開しますが、ブラウザによっては安定性に差があります  
- 音声認識にはわずかな遅延があります
- 音声認識の精度により、誤入力が発生する可能性がありますが、手動修正が可能です

---

## 🛠️ 技術メモ

- 使用API: Web Speech API（SpeechRecognition）  
- 音声入力対応単語:
  - 長さ → `○○ミリ`, `○○ミリメートル`
  - 重さ → `○○グラム`
  - 行追加 → `次`, `はい`
  - メモ機能 → `メモ` でメモモーダルを起動。`保存` で内容を記録、`キャンセル`で内容を破棄。
  - 停止 → `終了`
- 出力形式: CSV（カンマ区切り）  
- セルは `<td contenteditable="true">` として手動編集可能
- 行は常に**テーブルの先頭に追加される**
- 音声入力は**次の行へ切り替わるまで上書き対象**

---

## ✅ 推奨環境

| 項目 | 推奨 |
|------|------|
| ブラウザ | Google Chrome |
| 言語設定 | 日本語（ja-JP） |
| デバイス | PCまたは音声入力が可能なデバイス |

---

## 🆕 変更履歴

| バージョン | リリース日 | 更新内容 |
|------------|-----------|-----------|
| v1.0.0-beta.4 | 2025/05/11 | ・ 新規行を末尾ではなく先頭に追加するように修正<br>・ 「はい」という単語でも新規行を追加するように修正<br>・ 長さを入力する際に「センチ」ではなく「ミリ」もしくは「ミリメートル」で反応するように修正<br>・ 終了した際に入力対象行が空だったらその行を削除するように修正<br>・ メモ欄を追加。メモと発話すればメモモーダルが開き、音声入力が可能となる。保存またはキャンセルと発話すれば閉じる。手動入力にも対応。<br>・ ファビコンに🦪を設定<br>・ 画面下部に使い方ガイドを追加 |
| v1.0.0-beta.3 | 2025/04/24 | ・ ページを離れる際にテーブルにデータがある場合は確認ダイアログを表示するよう変更<br>・ 音声で「終了」と発言した際に認識停止処理を実行するよう対応 |
| v1.0.0-beta.2 | 2025/04/20 | ・ 「開始」ボタンを押すまでは「終了」ボタンが押せないように変更<br>・ テーブルが空のときは「ダウンロード」ボタンを押せないように変更<br>・ 長さ、重さの入力セルを編集可能に変更 |
| v1.0.0-beta.1 | 2025/04/18 | 初回リリース |
